{"version":3,"sources":["RoadMaker.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,KAAK,EAAE,gBAAgB,EAA2B,MAAM,mBAAmB,CAAC;AACpF,OAAO,KAAK,MAAM,SAAS,CAAC;AAE5B,8BAA8B;AAC9B,uEAAuE;AACvE,MAAM,CAAC,OAAO,OAAO,SAAS;IA0E5B;QAxEA,sCAAsC;QACtC,sCAAsC;QACtC,wCAAwC;QACxC,6BAA6B;QACrB,oBAAe,GAAY,KAAK,CAAC;QACjC,oBAAe,GAAY,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;QACzC,sBAAiB,GAAY,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;QAC3C,uBAAkB,GAAY,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;QAC5C,0BAAqB,GAAW,CAAC,CAAC;QAClC,oBAAe,GAAW,CAAC,CAAC;QAC5B,2BAAsB,GAAW,CAAC,CAAC;QAE3C,wDAAwD;QACxD,cAAc;QACN,kBAAa,GAAU,CAAC,CAAC;QAEjC,sCAAsC;QAC9B,2BAAsB,GAAU,EAAE,CAAC;QAE3C,iEAAiE;QACjE,aAAa;QACN,cAAS,GAAK,WAAW,CAAC;QAC1B,QAAG,GAAW,gBAAgB,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;QACxD,SAAI,GAAU,gBAAgB,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;QACzD,eAAU,GAAI,gBAAgB,CAAC,OAAO,CAAC,uBAAuB,CAAC,CAAC;QAChE,SAAI,GAAU,gBAAgB,CAAC,OAAO,CAAC,4BAA4B,CAAC,CAAC;QACrE,SAAI,GAAU,gBAAgB,CAAC,OAAO,CAAC,yBAAyB,CAAC,CAAC;QAClE,SAAI,GAAU,gBAAgB,CAAC,OAAO,CAAC,wBAAwB,CAAC,CAAC;QACjE,UAAK,GAAS,gBAAgB,CAAC,OAAO,CAAC,mBAAmB,CAAC,CAAC;QAEnE,2DAA2D;QAC3D,+BAA+B;QACvB,cAAS,GAA0B;YACzC,IAAI,CAAC,GAAG;YACR,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,IAAI;YACT,IAAI,CAAC,IAAI;YACT,IAAI,CAAC,IAAI;YACT,IAAI,CAAC,KAAK,CAAQ,GAAG;SACtB,CAAA;QAED,mEAAmE;QACnE,4DAA4D;QACpD,eAAU,GAAiB;YACjC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;SAAC,CAAC;QAEL,kBAAa,GAAiB;YACpC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;SAAC,CAAC;QAEL,eAAU,GAAiB;YACjC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;SAAC,CAAC;QAEL,kBAAa,GAAiB;YACpC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;YACT,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;SAAC,CAAC;QAKX,KAAK,CAAC,KAAK,CAAC,+BAA+B,CAAC,CAAC;IAC/C,CAAC;IAED,wCAAwC;IACxC,gBAAgB;QAEd,OAAO,IAAI,CAAC,eAAe,CAAC;IAC9B,CAAC;IAED,0DAA0D;IAC1D,gBAAgB;IAChB,YAAY;QAEV,OAAO,IAAI,CAAC,iBAAiB,CAAC;IAChC,CAAC;IAED,UAAU;QACR,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;QAC7B,IAAI,CAAC,eAAe,GAAG,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;QACrC,IAAI,CAAC,iBAAiB,GAAG,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;QACvC,IAAI,CAAC,kBAAkB,GAAG,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC,EAAC,CAAC;QACxC,IAAI,CAAC,qBAAqB,GAAG,CAAC,CAAC;QAC/B,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC;QACzB,IAAI,CAAC,sBAAsB,GAAG,CAAC,CAAC;IAClC,CAAC;IAGD,kBAAkB,CAAC,QAAe,EAAE,SAAgB;QAElD,IAAI;YACF,KAAK,CAAC,KAAK,CAAC,WAAW,QAAQ,OAAO,SAAS,EAAE,CAAC,CAAC;YACnD,IAAI,KAAK,GAAG,gBAAgB,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;YAChD,QAAO,QAAQ,EAAC;gBACd,KAAK,YAAY;oBACf,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;oBACxB,MAAM;gBACR,KAAK,MAAM;oBACT,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;oBAClB,MAAM;gBACR,KAAK,MAAM;oBACT,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;oBAClB,MAAM;gBACR,KAAK,MAAM;oBACT,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;oBAClB,MAAM;gBACR,KAAK,OAAO;oBACV,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;oBACnB,MAAM;aACT;YAED,IAAI,CAAC,SAAS,GAAE;gBACd,IAAI,CAAC,GAAG;gBACR,IAAI,CAAC,UAAU;gBACf,IAAI,CAAC,IAAI;gBACT,IAAI,CAAC,IAAI;gBACT,IAAI,CAAC,IAAI;gBACT,IAAI,CAAC,KAAK,CAAQ,GAAG;aACtB,CAAC;SACH;QACD,OAAM,CAAC,EACP;YACE,KAAK,CAAC,KAAK,CAAC,+BAA+B,SAAS,EAAE,CAAC,CAAC;YACxD,OAAO;SACR;IAGH,CAAC;IAED,yFAAyF;IACzF,0BAA0B;IAC1B,YAAY,CAAC,UAAmB,EAAE,aAAsB,EAAE,MAAc;QAEtE,sCAAsC;QACtC,IAAG,IAAI,CAAC,eAAe,KAAK,IAAI,EAChC;YACE,KAAK,CAAC,IAAI,CAAC,mEAAmE,CAAC,CAAC;YAChF,OAAO;SACR;QAED,KAAK,CAAC,KAAK,CAAC,YAAY,MAAM,YAAY,KAAK,CAAC,gBAAgB,CAAC,UAAU,CAAC,GAAG,CAAC,CAAA;QAEhF,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAC5B,IAAI,CAAC,sBAAsB,GAAG,SAAS,CAAC,kBAAkB,CAAC,aAAa,CAAC,CAAC;QAC1E,IAAI,CAAC,qBAAqB,GAAG,CAAC,CAAC;QAC/B,IAAI,CAAC,eAAe,GAAG,UAAU,CAAC;QAClC,IAAI,CAAC,kBAAkB,GAAG,aAAa,CAAC;QACxC,IAAI,CAAC,eAAe,GAAG,MAAM,CAAC;QAE9B,8DAA8D;QAC9D,IAAI,CAAC,iBAAiB,GAAG;YACvB,CAAC,EAAE,UAAU,CAAC,CAAC;YACf,CAAC,EAAE,UAAU,CAAC,CAAC;YACf,CAAC,EAAE,UAAU,CAAC,CAAC;SAChB,CAAC;IACJ,CAAC;IAED,qEAAqE;IACrE,iCAAiC;IACjC,gBAAgB;QAEd,iCAAiC;QACjC,IAAG,IAAI,CAAC,eAAe,KAAK,KAAK,EAAE;YACjC,OAAO;SACR;QAED,KAAK,CAAC,KAAK,CAAC,kBAAkB,IAAI,CAAC,qBAAqB,IAAI,IAAI,CAAC,eAAe,EAAE,CAAC,CAAC;QAEpF,IAAI,gBAAgB,GAAG,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,aAAa,CAAC;QACvE,IAAI,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,EAAE,gBAAgB,CAAC,CAAC;QAEnE,uFAAuF;QACvF,gFAAgF;QAChF,yBAAyB;QACzB,KAAI,IAAI,CAAC,GAAG,IAAI,CAAC,qBAAqB,GAAG,CAAC,EAAE,CAAC,IAAI,WAAW,EAAE,CAAC,EAAE,EACjE;YACE,IAAI,UAAU,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YAC7B,IAAI,YAAY,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;YAEhC,gDAAgD;YAChD,IAAI,aAAa,GAAkB,IAAI,CAAC,sBAAsB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC;YACpF,IAAI,iBAAiB,GAAG,IAAI,CAAC,sBAAsB,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACjE,IAAI,CAAC,iBAAiB,CAAC,aAAa,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC;YAEtG,6BAA6B;YAC7B,IAAI,aAAa,GAAG,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC;YAEtE,uCAAuC;YACvC,IAAG,IAAI,CAAC,QAAQ,CAAC,EAAC,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC,EAAC,CAAC,EAAE,WAAW,KAAK,IAAI,CAAC,GAAG,EACvI;gBACE,aAAa,GAAG,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC;aACnE;YAED,kDAAkD;YAClD,IAAI,QAAQ,GAAG,EAAC,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC,EAAC,CAAA;YAC1G,IAAI,aAAa,GAAG,CAAC,CAAC;YACtB,OAAM,YAAY,IAAI,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,WAAW,KAAK,IAAI,CAAC,IAAI,IAAI,aAAa,GAAG,IAAI,CAAC,sBAAsB,EACvH;gBACE,IAAG;oBACD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;oBACzC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC;oBAChB,aAAa,EAAE,CAAC;iBACjB;gBACD,OAAM,CAAC,EACP;oBACE,MAAM;iBACP;aACF;YAED,kBAAkB;YAClB,IAAI;gBACF,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,sBAAsB,CAAC,CAAC;aACtF;YACD,OAAM,CAAC,EACP;gBACE,KAAK,CAAC,KAAK,CAAC,gCAAgC,CAAC,GAAG,CAAC,CAAC;aACnD;SACF;QAED,IAAI,CAAC,qBAAqB,GAAG,WAAW,CAAC;QACzC,IAAG,WAAW,IAAI,IAAI,CAAC,eAAe,EACtC;YACE,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;SAC9B;IACH,CAAC;IAED,0EAA0E;IAC1E,uEAAuE;IACvE,kCAAkC;IAClC,WAAW,CAAC,aAA4B,EAAE,KAAa,EAAE,iBAAyB;QAEhF,MAAM,SAAS,GAAG,CAAC,CAAC;QACpB,MAAM,SAAS,GAAG,CAAC,CAAC,CAAC;QAErB,KAAK,CAAC,KAAK,CAAC,sBAAsB,KAAK,CAAC,gBAAgB,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QAEnE,+CAA+C;QAC/C,kDAAkD;QAClD,iDAAiD;QACjD,OAAO;QACP,KAAI,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,CAAC,EAAE,GAAG,EAAE,EAC/B;YACE,wCAAwC;YACxC,4CAA4C;YAC5C,2CAA2C;YAC3C,kDAAkD;YAClD,KAAI,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,CAAC,EAAE,GAAG,EAAE,EAC/B;gBACE,4CAA4C;gBAC5C,IAAI,UAAU,GAAG,aAAa,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;gBAEhD,0CAA0C;gBAC1C,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;gBAEvC,sDAAsD;gBACtD,QAAO,iBAAiB,EACxB;oBACE,KAAK,CAAC,EAAE,OAAO;wBACb,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE;4BACnB,CAAC,EAAE,KAAK,CAAC,CAAC;4BACV,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,CAAC,SAAS,GAAG,GAAG,CAAC;4BAC9B,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,CAAC,SAAS,GAAG,GAAG,CAAC;yBAC/B,CAAC,CAAC;wBACH,MAAM;oBACR,KAAK,CAAC,EAAE,QAAQ;wBACd,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE;4BACnB,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,CAAC,SAAS,GAAG,GAAG,CAAC;4BAC9B,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,CAAC,SAAS,GAAG,GAAG,CAAC;4BAC9B,CAAC,EAAE,KAAK,CAAC,CAAC;yBACX,CAAC,CAAC;wBACH,MAAM;oBACR,KAAK,CAAC,EAAE,OAAO;wBACb,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE;4BACnB,CAAC,EAAE,KAAK,CAAC,CAAC;4BACV,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,CAAC,SAAS,GAAG,GAAG,CAAC;4BAC9B,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,CAAC,SAAS,GAAG,GAAG,CAAC;yBAC/B,CAAC,CAAC;wBACH,MAAM;oBACR,KAAK,CAAC,EAAE,QAAQ;wBACd,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE;4BACnB,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,CAAC,SAAS,GAAG,GAAG,CAAC;4BAC9B,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,CAAC,SAAS,GAAG,GAAG,CAAC;4BAC9B,CAAC,EAAE,KAAK,CAAC,CAAC;yBACX,CAAC,CAAC;wBACH,MAAM;iBACT;aACF;SACF;IACH,CAAC;IAED,yEAAyE;IACzE,QAAQ,CAAC,SAA0B,EAAE,KAAa;QAChD,KAAK,CAAC,KAAK,CAAC,oBAAoB,KAAK,CAAC,gBAAgB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAClE,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,cAAc,CAAC,SAAS,CAAC,CAAC;IAClD,CAAC;IAED,6CAA6C;IAC7C,QAAQ,CAAC,KAAc;QAErB,MAAM,SAAS,GAAG,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACrD,OAAO,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAA;IAClC,CAAC;IAED,gEAAgE;IAChE,WAAW;IACX,YAAY;IACZ,WAAW;IACX,YAAY;IACZ,MAAM,CAAC,kBAAkB,CAAC,aAAqB;QAE7C,+BAA+B;QAC/B,IAAI,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,EAAE,aAAa,CAAC,CAAC,CAAC,CAAC;QAE/D,sCAAsC;QACtC,OAAM,WAAW,GAAG,CAAC,EACrB;YACE,WAAW,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;SAC9B;QAED,gDAAgD;QAChD,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,GAAG,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;QAEvD,gCAAgC;QAChC,QAAQ,GAAG,QAAQ,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC;QAEvC,KAAK,CAAC,KAAK,CAAC,oCAAoC,QAAQ,GAAG,CAAC,CAAC;QAC7D,OAAO,QAAQ,CAAC;IAClB,CAAC;CACF","file":"../chonky_cabbage/scripts/RoadMaker.js","sourcesContent":["import {world, BlockPermutation, Vector3, Vector2, Block } from \"@minecraft/server\";\r\nimport Debug from \"./Debug\";\r\n\r\n// For block definitions, see:\r\n// https://www.npmjs.com/package/@minecraft/vanilla-data?activeTab=code\r\nexport default class RoadMaker {\r\n\r\n  // these fields are used to keep track\r\n  // of where we are in the current work\r\n  // queue, allowing us to do long-running\r\n  // work across multiple ticks\r\n  private queueInProgress: boolean = false;\r\n  private queueStartCoord: Vector3 = {x:0,y:0,z:0};\r\n  private queueWalkingCoord: Vector3 = {x:0,y:0,z:0};\r\n  private queueViewDirection: Vector3 = {x:0,y:0,z:0};\r\n  private queueCurrentIteration: number = 0;\r\n  private queueRoadLength: number = 0;\r\n  private queueCardinalDirection: number = 0;\r\n\r\n  // max amount of road slices that will be processed in a\r\n  // single tick\r\n  private SlicesPerTick:number = 2;\r\n\r\n  // max distance bridge supports can go\r\n  private MaxBridgeSupportHeight:number = 64;\r\n\r\n  // these properties allow implementations to specify the specific\r\n  // road style\r\n  public Dimension =   \"overworld\";\r\n  public Air =         BlockPermutation.resolve(\"minecraft:air\");\r\n  public Dirt =        BlockPermutation.resolve(\"minecraft:dirt\");\r\n  public Foundation =  BlockPermutation.resolve(\"minecraft:cobblestone\");\r\n  public Wall =        BlockPermutation.resolve(\"minecraft:cobblestone_wall\");\r\n  public Path =        BlockPermutation.resolve(\"minecraft:bamboo_planks\");\r\n  public Post =        BlockPermutation.resolve(\"minecraft:bamboo_fence\");\r\n  public Light =       BlockPermutation.resolve(\"minecraft:lantern\");\r\n\r\n  // this maps block types to an integer index, allowing easy\r\n  // creation of visual templates\r\n  private blockInts:Array<BlockPermutation> =[\r\n    this.Air,         //0\r\n    this.Foundation,  //1\r\n    this.Wall,        //2\r\n    this.Path,        //3\r\n    this.Post,        //4\r\n    this.Light        //5\r\n  ]\r\n\r\n  // these are template 5x5 \"slices\" of a type of road. These use the\r\n  // int list above to resolve blocks when rendering the slice\r\n  private RoadNormal:Array<number> = [\r\n    0,0,0,0,0,\r\n    0,0,0,0,0,\r\n    0,0,0,0,0,\r\n    2,0,0,0,2,\r\n    1,3,3,3,1];\r\n\r\n  private RoadNormalLit:Array<number> = [\r\n    5,0,0,0,5,\r\n    4,0,0,0,4,\r\n    4,0,0,0,4,\r\n    1,0,0,0,1,\r\n    1,3,3,3,1];\r\n  \r\n  private RoadTunnel:Array<number> = [\r\n    1,3,3,3,1,\r\n    1,0,0,0,1,\r\n    1,0,0,0,1,\r\n    1,0,0,0,1,\r\n    1,3,3,3,1];\r\n\r\n  private RoadTunnelLit:Array<number> = [\r\n    1,3,3,3,1,\r\n    1,0,0,0,1,\r\n    5,0,0,0,5,\r\n    1,0,0,0,1,\r\n    1,3,3,3,1];\r\n\r\n\r\n  constructor()\r\n  {\r\n    Debug.debug(\"RoadMaker has been created...\");\r\n  }\r\n\r\n  // returns whether a road is being built\r\n  isRoadInProgress() :boolean\r\n  {\r\n    return this.queueInProgress;\r\n  }\r\n\r\n  // returns where the road building is occuring so progress\r\n  // can be traced\r\n  getWorkPoint():Vector3\r\n  {\r\n    return this.queueWalkingCoord;\r\n  }\r\n\r\n  cancelRoad() {\r\n    this.queueInProgress = false;\r\n    this.queueStartCoord = {x:0,y:0,z:0};\r\n    this.queueWalkingCoord = {x:0,y:0,z:0};\r\n    this.queueViewDirection = {x:0,y:0,z:0};\r\n    this.queueCurrentIteration = 0;\r\n    this.queueRoadLength = 0;\r\n    this.queueCardinalDirection = 0;\r\n  }\r\n\r\n\r\n  tryAssignBlockType(blockKey:string, blockType:string)\r\n  {\r\n    try {\r\n      Debug.debug(`Setting ${blockKey} to ${blockType}`);\r\n      let block = BlockPermutation.resolve(blockType);\r\n      switch(blockKey){\r\n        case \"Foundation\":\r\n          this.Foundation = block;\r\n          break;\r\n        case \"Wall\":\r\n          this.Wall = block;\r\n          break;\r\n        case \"Path\":\r\n          this.Path = block;\r\n          break;\r\n        case \"Post\":\r\n          this.Post = block;\r\n          break;\r\n        case \"Light\":\r\n          this.Light = block;\r\n          break;\r\n      }\r\n\r\n      this.blockInts =[\r\n        this.Air,         //0\r\n        this.Foundation,  //1\r\n        this.Wall,        //2\r\n        this.Path,        //3\r\n        this.Post,        //4\r\n        this.Light        //5\r\n      ];\r\n    }\r\n    catch(e)\r\n    {\r\n      Debug.error(`Couldn't locate block type: ${blockType}`);\r\n      return;\r\n    }\r\n    \r\n    \r\n  }\r\n\r\n  // starts building a new road at the provided coordinates, in the provided view direction\r\n  // of the provided length.\r\n  startNewRoad(startCoord: Vector3, viewDirection: Vector3, length: number)\r\n  {\r\n    // EARLY OUT: road already in progress\r\n    if(this.queueInProgress === true)\r\n    {\r\n      Debug.warn(\"Cannot start a new road until the road in progress has completed.\");\r\n      return;\r\n    }\r\n\r\n    Debug.debug(`Starting ${length} road at ${Debug.printCoordinate3(startCoord)}.`)\r\n\r\n    this.queueInProgress = true;\r\n    this.queueCardinalDirection = RoadMaker.getCardinalInteger(viewDirection);\r\n    this.queueCurrentIteration = 0;\r\n    this.queueStartCoord = startCoord;\r\n    this.queueViewDirection = viewDirection;\r\n    this.queueRoadLength = length;\r\n\r\n    // copy our provided vector into an object we can walk through\r\n    this.queueWalkingCoord = {\r\n      x: startCoord.x,\r\n      y: startCoord.y,\r\n      z: startCoord.z\r\n    };\r\n  }\r\n\r\n  // builds a road segment for this tick, updates the inProgress status\r\n  // if the road has been completed\r\n  tryTickIteration() {\r\n\r\n    // EARLY OUT: nothing in progress\r\n    if(this.queueInProgress === false) {\r\n      return;\r\n    }\r\n\r\n    Debug.debug(`Building road: ${this.queueCurrentIteration}/${this.queueRoadLength}`);\r\n\r\n    let tickMaxIteration = this.queueCurrentIteration + this.SlicesPerTick;\r\n    let thisTickEnd = Math.min(this.queueRoadLength, tickMaxIteration);\r\n\r\n    // loop through our length, creating strips of road depending on our cardinal alignment\r\n    // we are 1 indexed so the road starts just in front of the player, otherwise it\r\n    // won't render correctly\r\n    for(let i = this.queueCurrentIteration + 1; i <= thisTickEnd; i++)\r\n    {\r\n      let drawLights = i % 8 === 0;\r\n      let drawSupports = i % 16 === 0;\r\n\r\n      // dynamically set our length-walking coordinate\r\n      let coordToChange: keyof Vector3 = this.queueCardinalDirection % 2 == 0 ? \"x\" : \"z\";\r\n      let directionModifier = this.queueCardinalDirection > 1 ? -1 : 1;\r\n      this.queueWalkingCoord[coordToChange] = this.queueStartCoord[coordToChange] + (i * directionModifier);\r\n\r\n      // resolve our slice template\r\n      let sliceTemplate = drawLights ? this.RoadNormalLit : this.RoadNormal;\r\n\r\n      // figure out if we should be tunneling\r\n      if(this.getBlock({x: this.queueWalkingCoord.x, y: this.queueWalkingCoord.y + 4, z: this.queueWalkingCoord.z})?.permutation !== this.Air)\r\n      {\r\n        sliceTemplate = drawLights ? this.RoadTunnelLit : this.RoadTunnel;\r\n      }\r\n\r\n      // figure out if we are floating and need supports\r\n      let supportY = {x: this.queueWalkingCoord.x, y: this.queueWalkingCoord.y - 1, z: this.queueWalkingCoord.z}\r\n      let supportHeight = 0;\r\n      while(drawSupports && this.getBlock(supportY)?.permutation !== this.Dirt && supportHeight < this.MaxBridgeSupportHeight)\r\n      {\r\n        try{\r\n          this.setBlock(this.Foundation, supportY);\r\n          supportY.y -= 1;\r\n          supportHeight++;\r\n        }\r\n        catch(e)\r\n        {\r\n          break;\r\n        }\r\n      }\r\n\r\n      // render our road\r\n      try {\r\n        this.renderSlice(sliceTemplate, this.queueWalkingCoord, this.queueCardinalDirection);\r\n      }\r\n      catch(e)\r\n      {\r\n        Debug.error(`Failed to render road slice: ${e}.`);\r\n      }\r\n    }\r\n\r\n    this.queueCurrentIteration = thisTickEnd;\r\n    if(thisTickEnd == this.queueRoadLength)\r\n    {\r\n      this.queueInProgress = false;\r\n    }\r\n  }\r\n\r\n  // renders a single slice of road using the provided template. It uses the\r\n  // coordinate as the bottom center of the template slice and transforms\r\n  // based on the cardinal direction\r\n  renderSlice(sliceTemplate: Array<number>, coord:Vector3, cardinalDirection: number)\r\n  {\r\n    const rowOffset = 4;\r\n    const colOffset = -2;\r\n\r\n    Debug.trace(`Rendering slice at ${Debug.printCoordinate3(coord)}`);\r\n\r\n    // loop through each row in the slice template,\r\n    // we start at 5 above the starting coord and loop\r\n    // in reverse so we render the slice from the top\r\n    // left\r\n    for(let row = 0; row < 5; row++)\r\n    {\r\n      // loop through each column in this row,\r\n      // we start at -2 so that we start rendering\r\n      // blocks to the left of the starting coord\r\n      // and center the slice at the bottom center block\r\n      for(let col = 0; col < 5; col++)\r\n      {\r\n        // get the block int from the slice template\r\n        var blockIndex = sliceTemplate[(row * 5) + col];\r\n\r\n        // resolve the block type based on the int\r\n        var block = this.blockInts[blockIndex];\r\n\r\n        // transform our slice based on the cardinal direction\r\n        switch(cardinalDirection)\r\n        {\r\n          case 0: // west\r\n            this.setBlock(block, {\r\n              x: coord.x,\r\n              y: coord.y + (rowOffset - row),\r\n              z: coord.z + (colOffset + col)\r\n            });\r\n            break;\r\n          case 1: // south\r\n            this.setBlock(block, {\r\n              x: coord.x + (colOffset + col),\r\n              y: coord.y + (rowOffset - row),\r\n              z: coord.z\r\n            });\r\n            break;\r\n          case 2: // east\r\n            this.setBlock(block, {\r\n              x: coord.x,\r\n              y: coord.y + (rowOffset - row),\r\n              z: coord.z - (colOffset + col)\r\n            });\r\n            break;\r\n          case 3: // north\r\n            this.setBlock(block, {\r\n              x: coord.x - (colOffset + col),\r\n              y: coord.y + (rowOffset - row),\r\n              z: coord.z\r\n            });\r\n            break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // sets the block at the provided coordinates to the provided permutation\r\n  setBlock(blockPerm:BlockPermutation, coord:Vector3) {\r\n    Debug.trace(`Setting block at ${Debug.printCoordinate3(coord)}.`);\r\n    this.getBlock(coord)?.setPermutation(blockPerm);\r\n  }\r\n\r\n  // gets the block at the provided coordinates\r\n  getBlock(coord: Vector3)\r\n  {\r\n    const overworld = world.getDimension(this.Dimension);\r\n    return overworld.getBlock(coord)\r\n  }\r\n\r\n  // gets a cardinally-aligned value expressed as an integer where\r\n  // 0 = West\r\n  // 1 = South\r\n  // 2 = East\r\n  // 3 = North\r\n  static getCardinalInteger(viewDirection:Vector3): number\r\n  {\r\n    // figure out our 2d look angle\r\n    let lookAngle2d = Math.atan2(viewDirection.z, viewDirection.x);\r\n\r\n    // regulate our angle so it's positive\r\n    while(lookAngle2d < 0)\r\n    {\r\n      lookAngle2d += (Math.PI * 2);\r\n    }\r\n\r\n    // clamp our look angle to a cardinal coordinate\r\n    let cardinal = Math.round(lookAngle2d / (Math.PI / 2));\r\n\r\n    // clamp our look angle to 0 - 3\r\n    cardinal = cardinal > 3 ? 0 : cardinal;\r\n\r\n    Debug.trace(`Calculated cardinal direction at ${cardinal}.`);\r\n    return cardinal;\r\n  }\r\n}"],"sourceRoot":"../../../scripts/"}